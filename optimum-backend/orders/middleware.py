"""
Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip




Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip




Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip







Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip




Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip




Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip


Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip

Rate limiting middleware for order endpoints
"""
from django.core.cache import cache
from django.http import JsonResponse
from django.utils import timezone
import time


class RateLimitMiddleware:
    """
    Simple rate limiting middleware
    Rate limits are per IP address
    """
    def __init__(self, get_response):
        self.get_response = get_response
        # Rate limits: {endpoint: (requests, window_seconds)}
        self.rate_limits = {
            '/api/orders/': (100, 60),  # 100 requests per minute
            '/api/orders/create/': (10, 60),  # 10 creates per minute
            '/api/customers/': (50, 60),  # 50 requests per minute
            '/api/suppliers/': (50, 60),  # 50 requests per minute
        }

    def __call__(self, request):
        # Only apply to API endpoints
        if not request.path.startswith('/api/'):
            return self.get_response(request)

        # Get client IP
        ip = self.get_client_ip(request)
        
        # Check rate limit for this endpoint
        endpoint = request.path
        if endpoint in self.rate_limits:
            requests_allowed, window_seconds = self.rate_limits[endpoint]
            
            # Create cache key
            cache_key = f'ratelimit:{ip}:{endpoint}'
            
            # Get current count
            current_count = cache.get(cache_key, 0)
            
            if current_count >= requests_allowed:
                return JsonResponse(
                    {
                        'error': 'Rate limit exceeded',
                        'message': f'Too many requests. Limit: {requests_allowed} per {window_seconds} seconds'
                    },
                    status=429
                )
            
            # Increment count
            cache.set(cache_key, current_count + 1, window_seconds)
        
        return self.get_response(request)

    def get_client_ip(self, request):
        """Get client IP address from request"""
        x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
        if x_forwarded_for:
            ip = x_forwarded_for.split(',')[0]
        else:
            ip = request.META.get('REMOTE_ADDR')
        return ip








