"use strict";(self.webpackChunkoptimum_frontend=self.webpackChunkoptimum_frontend||[]).push([[751],{8751:(e,s,a)=>{a.r(s),a.d(s,{default:()=>c});var r=a(9379),n=a(5043),o=a(6446),l=a(5016),i=a(8254),t=a(1231),d=a(579);const c=()=>{const{user:e}=(0,l.A)(),s=(0,i.d)(),[a,c]=(0,n.useState)({first_name:"",last_name:"",email:"",phone_number:"",company_name:"",role:"PRODUCT_REQUESTER",location:{address:"",latitude:null,longitude:null},password:"",additional_data:{}}),[m,u]=(0,n.useState)({}),[p,h]=(0,n.useState)(!1),[g,x]=(0,n.useState)(!1),[v,j]=(0,n.useState)([]),[_,f]=(0,n.useState)(!1),[N,y]=(0,n.useState)(!1),b=()=>{var s;if(!e)return!1;const a=(e.email||"").toLowerCase(),r=e.role||(null===(s=e.profile)||void 0===s?void 0:s.role);return"sherifrosas.ai@gmail.com"===a||"ADMIN"===r||"SUB_ADMIN"===r};(0,n.useEffect)(()=>{b()?(C(),w()):s.error("Access denied. Admin privileges required.")},[]);const w=()=>{if(window.google&&window.google.maps)return y(!0),void setTimeout(A,100);if(document.querySelector('script[src*="maps.googleapis.com"]')){const e=setInterval(()=>{window.google&&window.google.maps&&(y(!0),A(),clearInterval(e))},100);return}const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_GOOGLE_MAPS_API_KEY;if(!e)return void console.warn("Google Maps API key not found. Location autocomplete will not work.");const s=document.createElement("script");s.src="https://maps.googleapis.com/maps/api/js?key=".concat(e,"&libraries=places"),s.async=!0,s.defer=!0,s.onload=()=>{y(!0),setTimeout(A,100)},s.onerror=()=>{console.error("Failed to load Google Maps API")},document.head.appendChild(s)},A=()=>{if(!window.google||!window.google.maps)return;const e=document.getElementById("location-address");if(!e)return;const s=new window.google.maps.places.Autocomplete(e,{types:["address"],fields:["formatted_address","geometry","name"]});s.addListener("place_changed",()=>{const e=s.getPlace();e.geometry&&c(s=>(0,r.A)((0,r.A)({},s),{},{location:{address:e.formatted_address||e.name,latitude:e.geometry.location.lat(),longitude:e.geometry.location.lng()}}))})};(0,n.useEffect)(()=>{N&&(window.requestIdleCallback?window.requestIdleCallback(()=>{A()},{timeout:1e3}):setTimeout(A,100))},[N]);const C=async()=>{try{const e=await t.y.listUsers();j(e.data||[])}catch(e){console.error("Error loading users:",e)}},S=(0,n.useCallback)(e=>{const{name:s,value:a}=e.target;n.startTransition(()=>{c("location-address"===s?e=>(0,r.A)((0,r.A)({},e),{},{location:(0,r.A)((0,r.A)({},e.location),{},{address:a})}):e=>(0,r.A)((0,r.A)({},e),{},{[s]:a})),m[s]&&u(e=>(0,r.A)((0,r.A)({},e),{},{[s]:""}))})},[m]),E=(e,s)=>{c(a=>(0,r.A)((0,r.A)({},a),{},{additional_data:(0,r.A)((0,r.A)({},a.additional_data),{},{[e]:s})}))};return b()?(0,d.jsx)("div",{className:"admin-user-management",children:(0,d.jsxs)(o.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"admin-user-container",children:[(0,d.jsxs)("div",{className:"admin-user-header",children:[(0,d.jsx)("h1",{children:"User Management"}),(0,d.jsx)("p",{children:"Create and manage user accounts for the system"}),(0,d.jsxs)("button",{className:"toggle-users-btn",onClick:()=>f(!_),children:[_?"Hide":"Show"," User List"]})]}),_&&(0,d.jsxs)("div",{className:"users-list-section",children:[(0,d.jsx)("h2",{children:"All Users"}),(0,d.jsx)("div",{className:"users-grid",children:v.map(e=>{var s,a,r,n,o,l;return(0,d.jsxs)("div",{className:"user-card",children:[(0,d.jsxs)("div",{className:"user-card-header",children:[(0,d.jsxs)("span",{className:"user-name",children:[e.first_name," ",e.last_name]}),(0,d.jsx)("span",{className:"user-role-badge role-".concat(null===(s=e.profile)||void 0===s||null===(a=s.role)||void 0===a?void 0:a.toLowerCase()),children:(null===(r=e.profile)||void 0===r?void 0:r.role)||"N/A"})]}),(0,d.jsxs)("div",{className:"user-card-body",children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Email:"})," ",e.email]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Phone:"})," ",(null===(n=e.profile)||void 0===n?void 0:n.phone_number)||"N/A"]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Company:"})," ",(null===(o=e.profile)||void 0===o?void 0:o.company_name)||"N/A"]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Status:"})," ",(null===(l=e.profile)||void 0===l?void 0:l.status)||"N/A"]})]})]},e.id)})})]}),(0,d.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return a.first_name.trim()||(e.first_name="First name is required"),a.last_name.trim()||(e.last_name="Last name is required"),a.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)||(e.email="Invalid email format"):e.email="Email is required",a.phone_number.trim()||(e.phone_number="Phone number is required"),a.location.address.trim()||(e.location="Location is required"),a.role||(e.role="Role is required"),u(e),0===Object.keys(e).length})())if(b()){h(!0);try{const e={first_name:a.first_name.trim(),last_name:a.last_name.trim(),email:a.email.trim(),phone_number:a.phone_number.trim(),company_name:a.company_name.trim(),role:a.role,password:a.password||void 0,metadata:(0,r.A)({location:a.location},a.additional_data)},n=await t.y.createUser(e);n.user&&(s.success("User created successfully! ".concat(n.generated_password?"Password: ".concat(n.generated_password):"")),c({first_name:"",last_name:"",email:"",phone_number:"",company_name:"",role:"PRODUCT_REQUESTER",location:{address:"",latitude:null,longitude:null},password:"",additional_data:{}}),C())}catch(p){var n,o,l,i,d,m;const e=(null===(n=p.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.detail)||(null===(l=p.response)||void 0===l||null===(i=l.data)||void 0===i?void 0:i.error)||"Failed to create user";s.error(e),null!==(d=p.response)&&void 0!==d&&null!==(m=d.data)&&void 0!==m&&m.errors&&u(p.response.data.errors)}finally{h(!1)}}else s.error("Access denied. Admin privileges required.");else s.error("Please fix the errors in the form")},className:"admin-user-form",noValidate:!0,children:[(0,d.jsxs)("div",{className:"form-section",children:[(0,d.jsx)("h2",{children:"Basic Information"}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"first_name",children:"First Name *"}),(0,d.jsx)("input",{type:"text",id:"first_name",name:"first_name",value:a.first_name,onChange:S,className:m.first_name?"error":"",required:!0}),m.first_name&&(0,d.jsx)("span",{className:"error-message",children:m.first_name})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"last_name",children:"Last Name *"}),(0,d.jsx)("input",{type:"text",id:"last_name",name:"last_name",value:a.last_name,onChange:S,className:m.last_name?"error":"",required:!0}),m.last_name&&(0,d.jsx)("span",{className:"error-message",children:m.last_name})]})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"email",children:"Email Address *"}),(0,d.jsx)("input",{type:"email",id:"email",name:"email",value:a.email,onChange:S,className:m.email?"error":"",required:!0}),m.email&&(0,d.jsx)("span",{className:"error-message",children:m.email})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"phone_number",children:"Phone Number *"}),(0,d.jsx)("input",{type:"tel",id:"phone_number",name:"phone_number",value:a.phone_number,onChange:S,className:m.phone_number?"error":"",placeholder:"+1234567890",required:!0}),m.phone_number&&(0,d.jsx)("span",{className:"error-message",children:m.phone_number})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"company_name",children:"Company Name"}),(0,d.jsx)("input",{type:"text",id:"company_name",name:"company_name",value:a.company_name,onChange:S})]})]}),(0,d.jsxs)("div",{className:"form-section",children:[(0,d.jsx)("h2",{children:"Role & Access"}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"role",children:"User Role *"}),(0,d.jsxs)("select",{id:"role",name:"role",value:a.role,onChange:S,className:m.role?"error":"",required:!0,children:[(0,d.jsx)("option",{value:"PRODUCT_REQUESTER",children:"Product Requester (Customer)"}),(0,d.jsx)("option",{value:"SUPPLIER",children:"Supplier"}),(0,d.jsx)("option",{value:"SUB_ADMIN",children:"Sub Admin"}),(0,d.jsx)("option",{value:"ADMIN",children:"Admin"})]}),m.role&&(0,d.jsx)("span",{className:"error-message",children:m.role})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsxs)("label",{htmlFor:"password",children:["Password (Optional)",(0,d.jsx)("span",{className:"hint",children:"Leave empty to auto-generate"})]}),(0,d.jsxs)("div",{className:"password-input-wrapper",children:[(0,d.jsx)("input",{type:g?"text":"password",id:"password",name:"password",value:a.password,onChange:S,placeholder:"Auto-generated if empty"}),(0,d.jsx)("button",{type:"button",className:"password-toggle",onClick:()=>x(!g),children:g?"\ud83d\udc41\ufe0f":"\ud83d\udc41\ufe0f\u200d\ud83d\udde8\ufe0f"})]})]})]}),(0,d.jsxs)("div",{className:"form-section",children:[(0,d.jsx)("h2",{children:"Location (Google Maps)"}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"location-address",children:"Address / Location *"}),(0,d.jsx)("input",{type:"text",id:"location-address",name:"location-address",value:a.location.address,onChange:S,className:m.location?"error":"",autoComplete:"off","data-lpignore":"true",placeholder:"Start typing an address...",required:!0}),m.location&&(0,d.jsx)("span",{className:"error-message",children:m.location}),a.location.latitude&&a.location.longitude&&(0,d.jsx)("div",{className:"location-coords",children:(0,d.jsxs)("small",{children:["Coordinates: ",a.location.latitude.toFixed(6),", ",a.location.longitude.toFixed(6)]})})]})]}),(0,d.jsxs)("div",{className:"form-section",children:[(0,d.jsx)("h2",{children:"Additional Data (Optional)"}),(0,d.jsx)("div",{className:"additional-data-fields",children:(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"Custom Field 1"}),(0,d.jsx)("input",{type:"text",placeholder:"Key",onChange:e=>{const s=e.target.value,a=e.target.nextElementSibling;s&&a&&E(s,a.value)}}),(0,d.jsx)("input",{type:"text",placeholder:"Value",onChange:e=>{const s=e.target.previousElementSibling;s&&s.value&&E(s.value,e.target.value)}})]})})]}),(0,d.jsx)("div",{className:"form-actions",children:(0,d.jsx)("button",{type:"submit",className:"submit-button",disabled:p,children:p?"Creating User...":"Create User Account"})})]})]})}):(0,d.jsxs)("div",{className:"admin-access-denied",children:[(0,d.jsx)("h2",{children:"Access Denied"}),(0,d.jsx)("p",{children:"You need admin privileges to access this page."})]})}}}]);
//# sourceMappingURL=751.b3e12f32.chunk.js.map